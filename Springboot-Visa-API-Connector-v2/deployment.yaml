apiVersion: apps/v1
kind: Deployment
metadata:
  name: visa.api.connector-v2-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: visa-api-connector-v2
  template:
    metadata:
      labels:
        app: visa-api-connector-v2
    spec:
      initContainers:
        - name: init-visa-api-connector-v2
          image: jayasanka/visa-api-connector-v2:1.0
          command: ["/bin/sh", "-c", "cp -R /data/certs/* /data/certs/"]
          volumeMounts:
            - name: certs-volume
              mountPath: /data/certs
      containers:
        - name: visa-api-connector-v2
          image: jayasanka/visa-api-connector-v2:1.0
          env:
            - name: SPRING_VISA_CLIENT_SSL_TRUST_STORE
              value: /data/certs/visaApiConnector_keyAndCertBundle.jks
          volumeMounts:
            - name: logs-volume
              mountPath: /data/logs
      volumes:
        - name: certs-volume
          hostPath:
            path: /data/certs
            type: DirectoryOrCreate
        - name: logs-volume
          hostPath:
            path: /data/logs
            type: DirectoryOrCreate